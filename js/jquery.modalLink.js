!function(t){function e(e){var a=t("body").outerWidth(),o=t("body").outerWidth();t("body").css({width:a}),"function"==typeof e&&e(o-a)}function a(e){var a=t("body"),o=a.outerWidth();a.css({width:"",overflow:""});var i=a.outerWidth();"function"==typeof e&&e(o-i)}function o(t,e,a){return i(t,e+"="+a)}function i(t,e){return t+(t.indexOf("?")<0?"?":"&")+e}function n(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];if("boolean"==typeof a)return a;if("string"==typeof a){var o=t.attr(a);if(o){if("true"===o.toLowerCase())return!0;if("false"===o.toLowerCase())return!1}}}}t.modalLinkDefaults={height:600,width:900,showTitle:!0,showClose:!0,overlayOpacity:.6,method:"GET",disableScroll:!0,onHideScroll:function(){},onShowScroll:function(){}};var l={init:function(e){var a=t.extend({},t.modalLinkDefaults);return t.extend(a,e),this.each(function(){var e=t(this);e.hasClass("sparkling-modal-link")||(e.addClass("sparkling-modal-link"),e.click(function(t){return t.preventDefault(),l.open(e,a),!1}))})},close:function(e){var o=t(".sparkling-modal-container"),i=o.data("modallink");if(i){i.trigger("modallink.close");var n=o.find(".sparkling-modal-overlay"),l=o.find(".sparkling-modal-frame");n.fadeTo("fast",0),l.fadeTo("fast",0,function(){o.remove(),a(e),"function"==typeof e&&e()})}},open:function(a,r){var d,s,f,c,p;d=(r=r||{}).url||a.attr("href"),s=r.title||a.attr("data-ml-title")||a.attr("title")||a.text(),f=n(a,r.showTitle,"data-ml-show-title",t.modalLinkDefaults.showTitle),c=n(a,r.showClose,"data-ml-show-close",t.modalLinkDefaults.showClose),p=n(a,r.disableScroll,"data-ml-disable-scroll",t.modalLinkDefaults.disableScroll);var m=t.extend({},t.modalLinkDefaults);t.extend(m,r);var h=a.attr("data-ml-width");h&&(m.width=parseInt(h));var u=a.attr("data-ml-height");u&&(m.height=parseInt(u)),"CLONE"!==m.method&&d.length>0&&"#"===d[0]&&(m.method="REF"),"GET"!=m.method&&"POST"!=m.method||(d=o(d,"__inmodal","true"));var v={};void 0!==m.data&&(v="function"==typeof m.data?m.data():m.data);var y=t('<div class="sparkling-modal-container"></div>');y.data("modallink",a);var g=t('<div class="sparkling-modal-overlay"></div>');g.css({position:"fixed",top:0,left:0,opacity:0,width:"100%",height:"100%",zIndex:999}),g.appendTo(y),t(window).width()<="768"?pxmarginLeft=-m.width/2-20:pxmarginLeft=-m.width/2;var k=t('<div class="sparkling-modal-frame"></div>').css("opacity",0).css({zIndex:1e3,position:"fixed",display:"inline-block"}).css({left:"50%",marginLeft:pxmarginLeft}).css({top:"50%",marginTop:-m.height/2}).appendTo(y);if(t("body").append(y),f){var w=t('<div class="sparkling-modal-title"></div>');if(w.appendTo(k),w.append(t("<span></span>").html(s)),c){var T=t("<div class=\"sparkling-modal-close\"><div class='i-close'><div class='i-close-h' /><div class='i-close-v' /></div></div>");T.appendTo(w),T.click(l.close)}w.append('<div style="clear: both;"></div>')}var b=t('<div class="sparkling-modal-content"></div>');b.appendTo(k);var L;if("REF"==m.method){(L=t("<div />")).css("overflow","auto");var x=t(d),C="ref_"+(new Date).getTime(),S=t("<div id='"+C+"' />");S.insertAfter(x),x.appendTo(L),a.on("modallink.close",function(){S.replaceWith(x)})}else L=t("<iframe frameborder=0 id='modal-frame' name='modal-frame'></iframe>");if(L.appendTo(b),L.css({width:m.width,height:m.height}),"CLONE"==m.method){console.log(d);var D=t(d);console.log(D);var O=L[0].contentDocument||L[0].contentWindow.document;O.write(D.html()),O.close()}else if("GET"==m.method){if("object"==typeof v)for(var j in v)v.hasOwnProperty(j)&&(d=o(d,j,v[j]));else void 0!==v&&(d=i(d,v));L.attr("src",d)}if(k.css({marginTop:-k.outerHeight(!1)/2}),g.fadeTo("fast",m.overlayOpacity),k.fadeTo("fast",1),"POST"==m.method){var E=m.$form;if(E&&E instanceof jQuery){E.attr("target");E.attr("target","modal-frame").data("submitted-from-modallink",!0).submit()}else{if(E=t("<form />").attr("action",d).attr("method","POST").attr("target","modal-frame").css({display:"none"}),t("<input />").attr({type:"hidden",name:"__sparklingModalInit",value:1}).appendTo(E),t.isArray(v))for(var j in v)t("<input />").attr({type:"hidden",name:v[j].name,value:v[j].value}).appendTo(E);else for(var j in v)t("<input />").attr({type:"hidden",name:j,value:v[j]}).appendTo(E);E.appendTo("body").submit(),E.remove()}}p&&e(m.onHideScroll)}};t.fn.modalLink=function(e){return l[e]?l[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.modalLink"),this):l.init.apply(this,arguments)},t.modalLink=function(e){return l[e]?l[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.modalLink"),this):l.init.apply(this,arguments)},t.modalLink.open=function(e,a){(a=t.extend({},a)).url=e,l.open.call(this,t("<a />"),a)}}(jQuery),$(document).keyup(function(t){27==t.keyCode&&$.modalLink("close")})